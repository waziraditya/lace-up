<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="https://res.cloudinary.com/dqka2nzzx/image/upload/v1754921014/WhatsApp_Image_2025-08-11_at_7.29.30_PM-removebg-preview_euhtnk.png">
    <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8VB24K7D8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-Z8VB24K7D8');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - LaceUp</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .checkout-container {
      max-width: 1200px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 30px;
      padding: 0 20px;
    }
    .checkout-main {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    .section {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 12px;
    }
    .section h3 {
      margin: 0 0 15px;
      color: #ff6b35;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: rgba(255,255,255,0.9);
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      background: rgba(255,255,255,0.1);
      color: white;
    }
    .address-option {
      border: 2px solid rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .address-option:hover, .address-option.selected {
      border-color: #ff6b35;
    }
    .add-address-btn {
      background: transparent;
      border: 2px dashed rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.7);
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    }
    .order-summary {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 12px;
      height: fit-content;
      position: sticky;
      top: 20px;
    }
    .order-item {
      display: flex;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .order-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
    }
    .bill-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }
    .bill-total {
      border-top: 2px solid rgba(255,255,255,0.2);
      padding-top: 10px;
      font-weight: bold;
      font-size: 1.1em;
    }
    .place-order-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, #ff6b35, #f7931e);
      border: none;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 20px;
    }
    .payment-method {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .payment-option {
      flex: 1;
      min-width: 120px;
      padding: 12px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .payment-option:hover, .payment-option.selected {
      border-color: #ff6b35;
    }
    @media (max-width: 768px) {
      .checkout-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo" onclick="window.location.href='index.html'">üëü LaceUp</div>
    <nav class="nav-menu">
      <a href="index.html">Home</a>
      <a href="cart.html" id="cart-nav-link">Cart</a>
    </nav>
    <div class="nav-right">
      <a href="profile.html" id="profile-link">Profile</a>
      <a href="login.html" id="login-link">Login</a>
      <a href="signup.html" id="signup-link">Signup</a>
    </div>
  </header>

  <div class="checkout-container">
    <div class="checkout-main">
      <!-- Shipping Address -->
      <div class="section">
        <h3>üè† Shipping Address</h3>
        <div id="saved-addresses">
          <!-- Saved addresses will be loaded here -->
        </div>
        <button class="add-address-btn" onclick="toggleAddressForm()">+ Add New Address</button>
        
        <div id="address-form" style="display:none; margin-top:15px;">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="fullName" required>
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input type="tel" id="phone" required>
          </div>
          <div class="form-group">
            <label>Address Line 1</label>
            <input type="text" id="address1" required>
          </div>
          <div class="form-group">
            <label>Address Line 2 (Optional)</label>
            <input type="text" id="address2">
          </div>
          <div style="display:flex; gap:15px;">
            <div class="form-group" style="flex:1;">
              <label>City</label>
              <input type="text" id="city" required>
            </div>
            <div class="form-group" style="flex:1;">
              <label>State</label>
              <input type="text" id="state" required>
            </div>
            <div class="form-group" style="flex:1;">
              <label>PIN Code</label>
              <input type="text" id="pincode" required>
            </div>
          </div>
          <button type="button" onclick="saveAddress()" style="background:#28a745; color:white; border:none; padding:8px 16px; border-radius:4px; cursor:pointer;">Save Address</button>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="section">
        <h3>üí≥ Payment Method</h3>
        <div class="payment-method">
          <div class="payment-option" data-method="cod">
            <div>üíµ</div>
            <div>Cash on Delivery</div>
          </div>
          <div class="payment-option" data-method="upi">
            <div>üì±</div>
            <div>UPI</div>
          </div>
          <div class="payment-option" data-method="card">
            <div>üí≥</div>
            <div>Card</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
      <h3>üìã Order Summary</h3>
      <div id="order-items">
        <!-- Order items will be loaded here -->
      </div>
      
      <div style="margin-top:20px;">
        <div class="bill-row">
          <span>Subtotal:</span>
          <span>‚Çπ<span id="subtotal">0</span></span>
        </div>
        <div class="bill-row">
          <span>GST (18%):</span>
          <span>‚Çπ<span id="gst">0</span></span>
        </div>
        <div class="bill-row">
          <span>Shipping:</span>
          <span>‚Çπ<span id="shipping">99</span></span>
        </div>
        <div class="bill-row bill-total">
          <span>Total:</span>
          <span>‚Çπ<span id="total">0</span></span>
        </div>
      </div>
      
      <button class="place-order-btn" onclick="placeOrder()">Place Order</button>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    let selectedAddress = null;
    let selectedPayment = 'cod';
    let orderData = [];

    function loadCheckoutData() {
      const urlParams = new URLSearchParams(window.location.search);
      const isDirect = urlParams.get('direct') === 'true';
      
      if (isDirect) {
        orderData = JSON.parse(localStorage.getItem('directCheckout')) || [];
      } else {
        orderData = JSON.parse(localStorage.getItem('sneakCart')) || [];
      }
      
      if (orderData.length === 0) {
        window.location.href = 'cart.html';
        return;
      }
      
      renderOrderItems();
      calculateBill();
      loadSavedAddresses();
      setupPaymentSelection();
    }

    function renderOrderItems() {
      const container = document.getElementById('order-items');
      container.innerHTML = '';
      
      orderData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'order-item';
        div.innerHTML = `
          <img src="${item.image}" alt="${item.title}">
          <div style="flex:1;">
            <div style="font-weight:bold;">${item.title}</div>
            <div style="color:rgba(255,255,255,0.7); font-size:0.9em;">${item.brand}</div>
            <div style="color:rgba(255,255,255,0.7); font-size:0.9em;">Qty: ${item.qty || 1}</div>
            <div style="color:#ff6b35;">‚Çπ${((item.price || 0) * (item.qty || 1)).toLocaleString()}</div>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function calculateBill() {
      const subtotal = orderData.reduce((sum, item) => sum + ((item.price || 0) * (item.qty || 1)), 0);
      const gst = Math.round(subtotal * 0.18);
      const shipping = subtotal > 10000 ? 0 : 99;
      const total = subtotal + gst + shipping;
      
      document.getElementById('subtotal').textContent = subtotal.toLocaleString();
      document.getElementById('gst').textContent = gst.toLocaleString();
      document.getElementById('shipping').textContent = shipping.toLocaleString();
      document.getElementById('total').textContent = total.toLocaleString();
    }

    function loadSavedAddresses() {
      const addresses = JSON.parse(localStorage.getItem('savedAddresses')) || [];
      const container = document.getElementById('saved-addresses');
      
      addresses.forEach((addr, index) => {
        const div = document.createElement('div');
        div.className = 'address-option';
        div.onclick = () => selectAddress(index);
        div.innerHTML = `
          <div style="font-weight:bold;">${addr.fullName}</div>
          <div>${addr.address1}, ${addr.address2 ? addr.address2 + ', ' : ''}${addr.city}</div>
          <div>${addr.state} - ${addr.pincode}</div>
          <div style="color:rgba(255,255,255,0.7);">üìû ${addr.phone}</div>
        `;
        container.appendChild(div);
      });
      
      if (addresses.length > 0) {
        selectAddress(0);
      }
    }

    function selectAddress(index) {
      selectedAddress = index;
      document.querySelectorAll('.address-option').forEach((el, i) => {
        el.classList.toggle('selected', i === index);
      });
    }

    function toggleAddressForm() {
      const form = document.getElementById('address-form');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function saveAddress() {
      const address = {
        fullName: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        address1: document.getElementById('address1').value,
        address2: document.getElementById('address2').value,
        city: document.getElementById('city').value,
        state: document.getElementById('state').value,
        pincode: document.getElementById('pincode').value
      };
      
      if (!address.fullName || !address.phone || !address.address1 || !address.city || !address.state || !address.pincode) {
        alert('Please fill all required fields');
        return;
      }
      
      const addresses = JSON.parse(localStorage.getItem('savedAddresses')) || [];
      addresses.push(address);
      localStorage.setItem('savedAddresses', JSON.stringify(addresses));
      
      document.getElementById('address-form').style.display = 'none';
      document.querySelectorAll('#address-form input').forEach(input => input.value = '');
      
      loadSavedAddresses();
    }

    function setupPaymentSelection() {
      document.querySelectorAll('.payment-option').forEach(option => {
        option.addEventListener('click', () => {
          selectedPayment = option.dataset.method;
          document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('selected'));
          option.classList.add('selected');
        });
      });
      
      document.querySelector('.payment-option[data-method="cod"]').classList.add('selected');
    }

    function placeOrder() {
      if (selectedAddress === null) {
        alert('Please select a shipping address');
        return;
      }
      
      const addresses = JSON.parse(localStorage.getItem('savedAddresses')) || [];
      const orderDetails = {
        items: orderData,
        address: addresses[selectedAddress],
        payment: selectedPayment,
        subtotal: orderData.reduce((sum, item) => sum + ((item.price || 0) * (item.qty || 1)), 0),
        timestamp: new Date().toISOString(),
        orderId: 'LU' + Date.now()
      };
      
      // Save order
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      orders.push(orderDetails);
      localStorage.setItem('orders', JSON.stringify(orders));
      
      // Clear cart
      localStorage.removeItem('sneakCart');
      localStorage.removeItem('directCheckout');
      
      alert(`Order placed successfully! Order ID: ${orderDetails.orderId}`);
      window.location.href = 'index.html';
    }

    function goToCart() {
      const urlParams = new URLSearchParams(window.location.search);
      const isDirect = urlParams.get('direct') === 'true';
      
      if (isDirect) {
        // For direct checkout, save items back to directCheckout and go to cart with direct flag
        localStorage.setItem('directCheckout', JSON.stringify(orderData));
        window.location.href = 'cart.html?checkout=direct';
      } else {
        // For regular checkout, items are already in cart
        window.location.href = 'cart.html';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadCheckoutData();
      
      // Setup cart navigation
      document.getElementById('cart-nav-link').addEventListener('click', (e) => {
        e.preventDefault();
        goToCart();
      });
    });
  </script>
</body>
</html>
